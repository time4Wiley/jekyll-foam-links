# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Jekyll plugin that converts Foam-style wikilinks (`[[page-name]]`) to standard markdown reference-style links during build time, without modifying source files. The plugin enables compatibility between Foam note-taking tools and Jekyll static site generation.

## Common Development Commands

### Gem Building and Installation
```bash
# Build the gem
rake build

# Install locally for testing
rake install:local

# Build and install gem (with network access)
rake install

# Clean build artifacts
rake clean

# Remove all generated files
rake clobber

# Create release and push to RubyGems (when ready)
rake release
```

### Development Setup
```bash
# Install dependencies
bundle install

# Build the gem for distribution
gem build jekyll-foam-links.gemspec
```

## Architecture

The plugin consists of a single main module that hooks into Jekyll's document processing pipeline:

### Core Components

1. **Main Plugin File** (`lib/jekyll-foam-links.rb`):
   - Registers a Jekyll hook for `:pre_render` on pages and documents
   - Processes only markdown files (`.md` extension)
   - Scans content for wikilinks `[[...]]` and embedded wikilinks `![[...]]`
   - Generates reference-style markdown definitions
   - Replaces wikilinks with standard markdown references

### Key Methods

- `find_target_document`: Locates the target document by matching basename or slug
- `generate_relative_path`: Calculates relative paths between source and target documents
- `extract_title`: Retrieves title from front matter, first H1, or filename
- `format_definition`: Creates properly formatted reference definitions

### Processing Flow

1. Hook triggers on pre-render for each markdown document
2. Scan for all wikilinks and embedded wikilinks
3. Find target documents in Jekyll's pages and collections
4. Generate relative paths and extract titles
5. Replace wikilinks with reference-style links
6. Append reference definitions between Foam-style markers

### Output Format

The plugin adds reference definitions at the end of documents:
```markdown
[//begin]: # "Autogenerated link references for markdown compatibility"
[page-name]: relative/path/to/page "Page Title"
[//end]: # "Autogenerated link references"
```

## Key Implementation Details

- Only processes `.md` files
- Handles both regular links `[[...]]` and embedded links `![[...]]`
- Supports spaces in filenames using angle brackets in definitions
- Falls back to placeholder definitions for non-existent links
- Preserves original source files (modifications only affect rendering)
- Compatible with Jekyll 3.7 to 5.0